<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Оценка онкологических рисков</title>
  <style>
    :root {
      --bg: #f3f4f6;
      --card-bg: #ffffff;
      --accent: #334155;
      --accent-soft: #e5e7eb;
      --border-soft: #d4d4d8;
      --danger: #b91c1c;
      --shadow-soft: 0 14px 35px rgba(15, 23, 42, 0.12);
      --radius-lg: 18px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #e5e7eb, #f9fafb 50%, #e5e7eb);
      color: #111827;
      min-height: 100vh;
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    .page {
      max-width: 980px;
      width: 100%;
      padding: 24px 16px 40px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 24px;
      padding: 24px 22px 26px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    h1 {
      text-align: center;
      margin: 0 0 4px;
      font-size: 26px;
      letter-spacing: 0.02em;
    }

    h2 {
      text-align: center;
      margin: 0;
      font-size: 17px;
      color: #6b7280;
      font-weight: 500;
    }

    .subtitle {
      text-align: center;
      font-size: 13px;
      color: #6b7280;
      margin-top: 8px;
      margin-bottom: 18px;
    }

    fieldset {
      margin-bottom: 14px;
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      padding: 10px 14px 12px;
      background: #f9fafb;
    }

    legend {
      font-weight: 600;
      font-size: 13px;
      padding: 0 4px;
      color: #374151;
    }

    label {
      display: block;
      margin: 4px 0;
      font-size: 14px;
    }

    input[type="number"] {
      width: 110px;
      padding: 4px 6px;
      border-radius: 8px;
      border: 1px solid #d4d4d8;
      font-size: 14px;
      margin-left: 4px;
    }

    input[type="number"]:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.3);
    }

    .inline {
      display: inline-flex;
      align-items: center;
      margin-right: 10px;
      font-size: 14px;
    }

    .inline input {
      margin-right: 4px;
    }

    button {
      padding: 9px 18px;
      font-size: 15px;
      cursor: pointer;
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #111827;
      color: #f9fafb;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
    }

    button:hover {
      background: #020617;
    }

    button:active {
      transform: translateY(1px);
    }

    .tabs {
      display: inline-flex;
      border-radius: 999px;
      padding: 3px;
      background: #e5e7eb;
      border: 1px solid #cbd5f5;
      margin: 12px auto 20px;
    }

    .tabs-wrapper {
      display: flex;
      justify-content: center;
    }

    .tab-button {
      padding: 6px 16px;
      border-radius: 999px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      color: #4b5563;
      transition: background 0.15s ease, color 0.15s ease, box-shadow 0.15s ease;
      white-space: nowrap;
    }

    .tab-button.active {
      background: #ffffff;
      color: #111827;
      box-shadow: 0 6px 12px rgba(15, 23, 42, 0.18);
    }

    .calculator {
      margin-top: 12px;
    }

    .result-box {
      margin-top: 16px;
      padding: 14px 14px 12px;
      border-radius: 16px;
      border: 1px solid #cbd5f5;
      background: #eef2ff;
    }

    .risk {
      font-weight: 700;
      font-size: 17px;
      margin-bottom: 8px;
      color: var(--accent);
    }

    .note {
      font-size: 12px;
      color: #6b7280;
      margin-top: 10px;
      border-top: 1px dashed #cbd5f5;
      padding-top: 6px;
    }

    .risk-high {
      color: #b45309;
    }
    .risk-very-high {
      color: var(--danger);
    }

    @media (max-width: 640px) {
      .card {
        padding: 18px 14px 20px;
        border-radius: 18px;
      }
      h1 {
        font-size: 22px;
      }
      .tabs {
        width: 100%;
        justify-content: space-between;
      }
      .tab-button {
        flex: 1;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <h1>Оценка онкологических рисков</h1>
      <h2>Учебный калькулятор для предварительной стратификации риска</h2>
      <p class="subtitle">
        Инструмент не заменяет консультацию врача. Решение о скрининге и лечении принимает специалист.
      </p>

      <div class="tabs-wrapper">
        <div class="tabs">
          <button type="button" class="tab-button active" id="tab-lung" onclick="showCalculator('lung')">
            Рак лёгкого
          </button>
          <button type="button" class="tab-button" id="tab-eso" onclick="showCalculator('eso')">
            Рак пищевода
          </button>
        </div>
      </div>

      <!-- КАЛЬКУЛЯТОР РАКА ЛЁГКОГО -->
      <div id="lungCalculator" class="calculator">
        <form id="lungForm" onsubmit="event.preventDefault(); calculateLungRisk();">

          <fieldset>
            <legend>1. Общие данные</legend>
            <label>
              Возраст:
              <input type="number" id="ageLung" min="0" max="120"> лет
            </label>
          </fieldset>

          <fieldset>
            <legend>2. Курение</legend>
            <label>Статус курения:</label>
            <label class="inline">
              <input type="radio" name="smokingStatus" value="never" checked> Никогда не курил(а)
            </label>
            <label class="inline">
              <input type="radio" name="smokingStatus" value="current"> Курю сейчас
            </label>
            <label class="inline">
              <input type="radio" name="smokingStatus" value="former"> Курил(а) раньше
            </label>

            <label>
              Сигарет в день (если когда-либо курили):
              <input type="number" id="cigsPerDay" min="0">
            </label>
            <label>
              Сколько лет вы курили (или курите):
              <input type="number" id="yearsSmoked" min="0">
            </label>
            <label>
              Если бросили: сколько лет назад?
              <input type="number" id="yearsSinceQuit" min="0">
            </label>
          </fieldset>

          <fieldset>
            <legend>3. Окружающая среда</legend>
            <label>
              <input type="checkbox" id="passiveSmoke">
              Постоянное пассивное курение (дома/на работе)
            </label>
            <label>
              <input type="checkbox" id="airPollution">
              Проживание в зоне сильного загрязнения воздуха / смога
            </label>
            <label>
              <input type="checkbox" id="radon">
              Известно о повышенном радоне в доме/регионе
            </label>
          </fieldset>

          <fieldset>
            <legend>4. Болезни лёгких</legend>
            <label>
              <input type="checkbox" id="copd">
              ХОБЛ
            </label>
            <label>
              <input type="checkbox" id="emphysema">
              Эмфизема лёгких
            </label>
            <label>
              <input type="checkbox" id="fibrosisMild">
              Лёгочный фиброз / рубцовые изменения (лёгкой/умеренной степени)
            </label>
            <label>
              <input type="checkbox" id="ipf">
              Идиопатический лёгочный фиброз (IPF)
            </label>
            <label>
              <input type="checkbox" id="asthmaOrMildLung">
              Астма, лёгкие бронхоэктазы
            </label>
          </fieldset>

          <fieldset>
            <legend>5. Наследственность и профессия</legend>
            <label>
              <input type="checkbox" id="familyHistory">
              У близких родственников был рак лёгкого
            </label>
            <label>
              <input type="checkbox" id="occupational">
              Длительная работа (≥5 лет) с асбестом, металлами (никель, кадмий, хром), кварцевой пылью, дизельной сажей
            </label>
          </fieldset>

          <fieldset>
            <legend>6. Иммунная система</legend>
            <label>
              <input type="checkbox" id="mildImmunodef">
              Лёгкий/умеренный иммунодефицит (длительная иммуносупрессия, ВИЧ со стабильным иммунитетом)
            </label>
            <label>
              <input type="checkbox" id="severeImmunodef">
              Выраженный иммунодефицит (ВИЧ с низким CD4, посттрансплантационный статус)
            </label>
          </fieldset>

          <fieldset>
            <legend>7. Метаболические факторы</legend>
            <label>
              <input type="checkbox" id="metabolic">
              Ожирение / метаболический синдром
            </label>
            <label>
              <input type="checkbox" id="diabetes2">
              Сахарный диабет 2 типа
            </label>
          </fieldset>

          <button type="submit">Рассчитать риск рака лёгкого</button>
        </form>

        <div id="resultLung" class="result-box" style="display:none;">
          <div class="risk" id="riskGroupLung"></div>
          <div id="recommendationLung"></div>
          <div class="note">
            Это не диагноз и не окончательное медицинское заключение. Решение о скрининге и лечении принимает врач.
          </div>
        </div>
      </div>

      <!-- КАЛЬКУЛЯТОР РАКА ПИЩЕВОДА -->
      <div id="esophagusCalculator" class="calculator" style="display:none;">
        <form id="esoForm" onsubmit="event.preventDefault(); calculateEsoRisk();">

          <fieldset>
            <legend>1. Общие данные</legend>
            <label>
              Возраст:
              <input type="number" id="ageEso" min="0" max="120"> лет
            </label>
            <label>
              Пол:
              <span class="inline">
                <input type="radio" name="sexEso" value="male" checked> Мужской
              </span>
              <span class="inline">
                <input type="radio" name="sexEso" value="female"> Женский
              </span>
            </label>
          </fieldset>

          <fieldset>
            <legend>2. Образ жизни</legend>
            <label>
              <input type="checkbox" id="esoSmoking">
              Курение (в настоящее время или в прошлом)
            </label>
            <label>
              <input type="checkbox" id="esoAlcohol">
              Регулярное употребление алкоголя (≥3 раз в неделю)
            </label>
          </fieldset>

          <fieldset>
            <legend>3. Питание</legend>
            <label>
              <input type="checkbox" id="esoVeryHot">
              Частое употребление очень горячей пищи/напитков
            </label>
            <label>
              <input type="checkbox" id="esoSpicy">
              Частое употребление острой пищи
            </label>
            <label>
              <input type="checkbox" id="esoRoughFood">
              Привычка к грубой, механически травмирующей пище
            </label>
          </fieldset>

          <fieldset>
            <legend>4. Заболевания пищевода и ЖКТ</legend>
            <label>
              <input type="checkbox" id="esoGERD">
              Гастроэзофагальная рефлюксная болезнь (ГЭРБ)
            </label>
            <label>
              <input type="checkbox" id="esoBarrett">
              Пищевод Барретта (диагностирован)
            </label>
            <label>
              <input type="checkbox" id="esoAchalasia">
              Ахалазия пищевода
            </label>
            <label>
              <input type="checkbox" id="esoBurn">
              Перенесённый химический ожог пищевода (кислоты, щёлочи и др.)
            </label>
            <label>
              <input type="checkbox" id="esoObesity">
              Ожирение (ИМТ ≥30) / выраженный избыточный вес
            </label>
          </fieldset>

          <fieldset>
            <legend>5. Наследственность</legend>
            <label>
              <input type="checkbox" id="esoFamilyHistory">
              У близких родственников был рак пищевода
            </label>
          </fieldset>

          <button type="submit">Рассчитать риск рака пищевода</button>
        </form>

        <div id="resultEso" class="result-box" style="display:none;">
          <div class="risk" id="riskGroupEso"></div>
          <div id="recommendationEso"></div>
          <div class="note">
            Это не диагноз и не окончательное медицинское заключение. Решение о наблюдении и скрининге (ВГДС) принимает врач.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Переключение вкладок
    function showCalculator(type) {
      const lungDiv = document.getElementById("lungCalculator");
      const esoDiv = document.getElementById("esophagusCalculator");
      const tabLung = document.getElementById("tab-lung");
      const tabEso = document.getElementById("tab-eso");

      if (type === "lung") {
        lungDiv.style.display = "block";
        esoDiv.style.display = "none";
        tabLung.classList.add("active");
        tabEso.classList.remove("active");
      } else {
        lungDiv.style.display = "none";
        esoDiv.style.display = "block";
        tabEso.classList.add("active");
        tabLung.classList.remove("active");
      }
    }

    // Универсальный геттер
    function getValue(id) {
      const el = document.getElementById(id);
      if (!el) return null;
      if (el.type === "checkbox") {
        return el.checked;
      }
      if (el.type === "number") {
        return el.value ? parseFloat(el.value) : 0;
      }
      return el.value;
    }

    function getSmokingStatus() {
      const radios = document.getElementsByName("smokingStatus");
      for (let r of radios) {
        if (r.checked) return r.value;
      }
      return "never";
    }

    function getEsoSex() {
      const radios = document.getElementsByName("sexEso");
      for (let r of radios) {
        if (r.checked) return r.value;
      }
      return "male";
    }

    // ==== РАК ЛЁГКОГО ====
    function calculateLungRisk() {
      const age = getValue("ageLung") || 0;
      const smokingStatus = getSmokingStatus();
      const cigsPerDay = getValue("cigsPerDay") || 0;
      const yearsSmoked = getValue("yearsSmoked") || 0;
      const yearsSinceQuit = getValue("yearsSinceQuit") || 0;

      const packYears = (cigsPerDay / 20) * yearsSmoked;

      const a = {
        age: age,
        packYears: packYears,
        smokingStatus: smokingStatus,
        yearsSinceQuit: yearsSinceQuit,
        hasPassiveSmoke: getValue("passiveSmoke"),
        hasAirPollution: getValue("airPollution"),
        hasRadon: getValue("radon"),
        hasAsthmaOrMildLung: getValue("asthmaOrMildLung"),
        hasMetabolicOrObesity: getValue("metabolic"),
        hasDiabetes2: getValue("diabetes2"),
        hasFamilyHistory: getValue("familyHistory"),
        hasCOPD: getValue("copd"),
        hasEmphysema: getValue("emphysema"),
        hasFibrosisMild: getValue("fibrosisMild"),
        hasIPF: getValue("ipf"),
        hasAutoimmuneLungFibrosis: false,
        hasOccupationalExposure: getValue("occupational"),
        hasMildImmunodef: getValue("mildImmunodef"),
        hasSevereImmunodef: getValue("severeImmunodef"),
        hasRiskMutations: false
      };

      const riskCode = determineLungRiskGroup(a);
      showLungResult(riskCode);
    }

    function determineLungRiskGroup(a) {
      if (
        a.packYears >= 30 ||
        a.hasIPF ||
        a.hasSevereImmunodef ||
        (a.packYears > 0 && a.hasOccupationalExposure) ||
        a.hasRiskMutations
      ) {
        return "very_high";
      }

      const is50to80 = a.age >= 50 && a.age <= 80;
      const isCurrentOrRecentSmoker =
        a.smokingStatus === "current" ||
        (a.smokingStatus === "former" && a.yearsSinceQuit < 15);

      if (is50to80 && a.packYears >= 20 && isCurrentOrRecentSmoker) {
        return "high";
      }

      if (
        a.hasFamilyHistory ||
        a.hasCOPD ||
        a.hasEmphysema ||
        a.hasFibrosisMild ||
        a.hasAutoimmuneLungFibrosis ||
        a.hasOccupationalExposure ||
        a.hasMildImmunodef
      ) {
        return "increased";
      }

      if (
        a.hasPassiveSmoke ||
        a.hasAirPollution ||
        a.hasRadon ||
        a.hasAsthmaOrMildLung ||
        a.hasMetabolicOrObesity ||
        a.hasDiabetes2
      ) {
        return "moderate";
      }

      return "low";
    }

    function showLungResult(code) {
      const resultDiv = document.getElementById("resultLung");
      const riskGroupEl = document.getElementById("riskGroupLung");
      const recEl = document.getElementById("recommendationLung");

      let title = "";
      let text = "";

      switch (code) {
        case "low":
          title = "Группа риска (рак лёгкого): НИЗКИЙ";
          text = "По вашим ответам вы относитесь к низкой группе риска по раку лёгкого. Рутинный скрининг (низкодозная КТ) обычно не показан. Важно избегать табачного дыма и обратиться к врачу при появлении симптомов (кашель, одышка, боль в груди, кровохарканье).";
          break;
        case "moderate":
          title = "Группа риска (рак лёгкого): УМЕРЕННЫЙ";
          text = "Вы относитесь к умеренной группе риска. Рутинный скрининг КТ не обязателен, но при стойком кашле, одышке, болях в грудной клетке или кровохаркании следует обсудить с врачом необходимость КТ-обследования.";
          break;
        case "increased":
          title = "Группа риска (рак лёгкого): ПОВЫШЕННЫЙ";
          text = "Вы относитесь к повышенной группе риска. Рекомендуется обсудить с врачом проведение низкодозной КТ лёгких 1 раз в 1–2 года (обычно начиная с 50 лет), а также наблюдаться у пульмонолога и контролировать функцию дыхания.";
          break;
        case "high":
          title = "Группа риска (рак лёгкого): ВЫСОКИЙ";
          text = "Вы относитесь к высокой группе риска. Международные рекомендации советуют проходить низкодозную КТ лёгких 1 раз в год (как правило, в возрасте 50–80 лет при стаже курения ≥20 pack-years). Обсудите программу скрининга с вашим врачом.";
          break;
        case "very_high":
          title = "Группа риска (рак лёгкого): ОЧЕНЬ ВЫСОКИЙ";
          text = "Вы относитесь к очень высокой группе риска. Обычно рекомендуется ежегодная низкодозная КТ лёгких (иногда чаще при наличии подозрительных изменений на КТ, например субсолидных узлов). Обязательно обсудите индивидуальный план наблюдения с онкологом или пульмонологом.";
          break;
      }

      if (code === "high") riskGroupEl.className = "risk risk-high";
      else if (code === "very_high") riskGroupEl.className = "risk risk-very-high";
      else riskGroupEl.className = "risk";

      riskGroupEl.textContent = title;
      recEl.textContent = text;
      resultDiv.style.display = "block";
    }

    // ==== РАК ПИЩЕВОДА ====
    function calculateEsoRisk() {
      const age = getValue("ageEso") || 0;
      const sex = getEsoSex();

      const e = {
        age: age,
        sex: sex,
        hasSmoking: document.getElementById("esoSmoking").checked,
        hasAlcoholRegular: document.getElementById("esoAlcohol").checked,
        eatsVeryHot: document.getElementById("esoVeryHot").checked,
        eatsSpicy: document.getElementById("esoSpicy").checked,
        eatsRoughFood: document.getElementById("esoRoughFood").checked,
        hasGERD: document.getElementById("esoGERD").checked,
        hasBarrett: document.getElementById("esoBarrett").checked,
        hasAchalasia: document.getElementById("esoAchalasia").checked,
        hasBurn: document.getElementById("esoBurn").checked,
        hasObesity: document.getElementById("esoObesity").checked,
        hasFamilyHistory: document.getElementById("esoFamilyHistory").checked
      };

      const riskCode = determineEsoRiskGroup(e);
      showEsoResult(riskCode);
    }

    function determineEsoRiskGroup(e) {
      let major = 0;
      if (e.hasSmoking) major++;
      if (e.hasAlcoholRegular) major++;
      if (e.hasGERD) major++;
      if (e.hasObesity) major++;
      if (e.hasAchalasia) major++;
      if (e.hasBurn) major++;
      if (e.hasBarrett) major++;
      if (e.hasFamilyHistory) major++;

      let minor = 0;
      if (e.eatsVeryHot) minor++;
      if (e.eatsSpicy) minor++;
      if (e.eatsRoughFood) minor++;

      if (
        e.hasBarrett ||
        (e.hasBurn && e.age >= 18) ||
        (e.hasAchalasia && e.age >= 40) ||
        (major >= 3 && e.age >= 50)
      ) {
        return "very_high";
      }

      if (
        (major >= 2 && e.age >= 50) ||
        (major >= 1 && e.age >= 50 && minor >= 1)
      ) {
        return "high";
      }

      if (
        major >= 1 ||
        (minor >= 2 && e.age >= 40)
      ) {
        return "increased";
      }

      if (
        minor >= 1 ||
        e.age >= 50
      ) {
        return "moderate";
      }

      return "low";
    }

    function showEsoResult(code) {
      const resultDiv = document.getElementById("resultEso");
      const riskGroupEl = document.getElementById("riskGroupEso");
      const recEl = document.getElementById("recommendationEso");

      let title = "";
      let text = "";

      switch (code) {
        case "low":
          title = "Группа риска (рак пищевода): НИЗКИЙ";
          text = "По вашим ответам вы относитесь к низкой группе риска по раку пищевода. Рутинное выполнение ВГДС с целью скрининга, как правило, не требуется. Важно обращаться к врачу при появлении симптомов (дисфагия, боль при глотании, похудание, анемия).";
          break;
        case "moderate":
          title = "Группа риска (рак пищевода): УМЕРЕННЫЙ";
          text = "У вас есть отдельные факторы риска, но совокупный риск оценивается как умеренный. Регулярный скрининг ВГДС для всех пациентов этой группы не обязателен. При наличии жалоб со стороны пищевода или желудка (изжога, дисфагия, боль, анемия) стоит обсудить с врачом необходимость эндоскопии.";
          break;
        case "increased":
          title = "Группа риска (рак пищевода): ПОВЫШЕННЫЙ";
          text = "Вы относитесь к повышенной группе риска. Рекомендуется обсудить с врачом выполнение ВГДС с оценкой слизистой пищевода и, при отсутствии патологии, рассматривать повторное обследование примерно 1 раз в 3–5 лет, особенно при сохранении факторов риска.";
          break;
        case "high":
          title = "Группа риска (рак пищевода): ВЫСОКИЙ";
          text = "Вы относитесь к высокой группе риска по раку пищевода. Обычно рекомендуется регулярное наблюдение с ВГДС ориентировочно каждые 3 года (интервал уточняется с врачом в зависимости от находок при эндоскопии и сопутствующих заболеваний).";
          break;
        case "very_high":
          title = "Группа риска (рак пищевода): ОЧЕНЬ ВЫСОКИЙ";
          text = "Вы относитесь к очень высокой группе риска (пищевод Барретта, перенесённый химический ожог, ахалазия или сочетание нескольких серьёзных факторов). Как правило, требуется регулярное эндоскопическое наблюдение: ВГДС с биопсией с интервалом от 1 до 3 лет, а при пищеводе Барретта — по индивидуальной схеме. Необходимо обсудить план наблюдения с гастроэнтерологом или онкологом.";
          break;
      }

      if (code === "high") riskGroupEl.className = "risk risk-high";
      else if (code === "very_high") riskGroupEl.className = "risk risk-very-high";
      else riskGroupEl.className = "risk";

      riskGroupEl.textContent = title;
      recEl.textContent = text;
      resultDiv.style.display = "block";
    }
  </script>
</body>
</html>
